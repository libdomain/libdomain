services:
  openldap:
    build: openldap-container
    container_name: openldap-server
    environment:
      PORT: 3890
    ports:
      - '3890:3890'
    restart: "no"
    healthcheck:
      test: ["CMD", "curl", "-f", "ldap://localhost:3890"]
      interval: 30s
      timeout: 10s
      retries: 5
  testenv:
    build: testenv-container
    container_name: testenv
    restart: "no"
    environment:
      - LDAP_SERVER=ldap://openldap-server:3890
    volumes:
      - data-volume:/app
    depends_on:
      openldap:
        condition: service_healthy

volumes:
  data-volume:
    external: true

